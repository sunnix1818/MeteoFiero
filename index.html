<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Meteo World Pro</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Segoe UI',sans-serif;min-height:100vh;display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,#4facfe,#00f2fe);color:white;}
.app{background:rgba(255,255,255,0.15);backdrop-filter:blur(25px);border-radius:25px;padding:25px;width:450px;max-width:95%;box-shadow:0 10px 50px rgba(0,0,0,0.3);position:relative;overflow:hidden;}
h1{text-align:center;margin-bottom:15px;}
input,button,select{width:100%;padding:12px;border-radius:12px;border:none;font-size:16px;margin-top:10px;}
button{font-weight:bold;cursor:pointer;background:#ffffff;color:#333;}
button:hover{opacity:0.9;}
.card{margin-top:20px;background:rgba(0,0,0,0.2);padding:15px;border-radius:15px;position:relative;}
.temp{font-size:50px;font-weight:bold;}
.small{font-size:14px;opacity:0.9;margin-top:5px;}
.hr{border:none;height:1px;background:rgba(255,255,255,0.3);margin:15px 0;}
.forecast{display:flex;justify-content:space-between;margin-top:15px;flex-wrap:wrap;}
.forecast-day{flex:1;margin:5px;background:rgba(255,255,255,0.1);border-radius:10px;padding:5px;text-align:center;}
.icon{font-size:28px;}
.night{background:linear-gradient(135deg,#0f2027,#203a43);}
.map-link{display:block;margin-top:10px;color:white;text-decoration:none;font-weight:bold;}
.map-link:hover{text-decoration:underline;}
.nuvola{position:absolute;width:100px;height:60px;background:rgba(255,255,255,0.3);border-radius:50%;top:20px;animation:muoviNuvole 40s linear infinite;}
@keyframes muoviNuvole{0%{left:-120px;}100%{left:500px;}}
.pioggia{position:absolute;width:2px;height:12px;background:rgba(255,255,255,0.5);animation:piove 1s linear infinite;}
@keyframes piove{0%{top:-12px;}100%{top:450px;}}
canvas{margin-top:15px;border-radius:15px;background:rgba(255,255,255,0.1);}
</style>
</head>
<body>
<div class="app" id="app">
    <div class="nuvola"></div>
    <h1>ğŸŒ Meteo World Pro</h1>
    <input id="citta" placeholder="Inserisci cittÃ  o codice postale">
    <button onclick="cercaCitta()">Cerca</button>
    <button onclick="usaPosizione()">ğŸ“ Posizione automatica</button>
    <select id="cittaInternazionale" onchange="selezionaCitta()">ğŸŒ Seleziona cittÃ  internazionale</select>

    <div id="meteo" class="card"></div>
    <div id="previsioni" class="forecast"></div>
    <canvas id="grafico" width="400" height="180"></canvas>
</div>

<script>
const API_KEY="28a319d5da8a97fe0488bd10b1aaa1e6";
const cittaInternazionali=["New York,US","London,GB","Paris,FR","Tokyo,JP","Sydney,AU"];

window.onload=()=>{ const sel=document.getElementById("cittaInternazionale"); cittaInternazionali.forEach(c=>{ const o=document.createElement("option"); o.value=c; o.textContent=c; sel.appendChild(o); }); }

function selezionaCitta(){ fetchMeteo(`q=${document.getElementById("cittaInternazionale").value}`); }

function cercaCitta(){ const c=document.getElementById("citta").value.trim(); if(!c)return; fetchMeteo(`q=${c}`); }

function usaPosizione(){ if(!navigator.geolocation){alert("Geolocalizzazione non supportata"); return;}
navigator.geolocation.getCurrentPosition(pos=>{ fetchMeteo(`lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`); }); }

function fetchMeteo(param){
    fetch(`https://api.openweathermap.org/data/2.5/weather?${param}&units=metric&lang=it&appid=${API_KEY}`)
    .then(res=>{if(!res.ok)throw new Error();return res.json()})
    .then(d=>mostraMeteo(d))
    .catch(()=>{document.getElementById("meteo").innerHTML="âŒ Dati non disponibili";document.getElementById("previsioni").innerHTML="";});
    
    fetch(`https://api.openweathermap.org/data/2.5/forecast?${param}&units=metric&lang=it&appid=${API_KEY}`)
    .then(res=>res.json())
    .then(d=>mostraPrevisioni(d));
}

function mostraMeteo(d){
    const alba=new Date(d.sys.sunrise*1000).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});
    const tramonto=new Date(d.sys.sunset*1000).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});
    const ora=new Date().toLocaleTimeString("it-IT");
    const nightClass=(new Date().getHours()>=18||new Date().getHours()<6)?"night":"";
    document.getElementById("app").className="app "+nightClass;

    document.getElementById("meteo").innerHTML=`
        <h2>${d.name}, ${d.sys.country}</h2>
        <div class="temp">${Math.round(d.main.temp)}Â°C</div>
        <div>${d.weather[0].description} <span class="icon">${getIcon(d.weather[0].icon)}</span></div>
        <div class="small">ğŸŒ¡ï¸ Percepita: ${Math.round(d.main.feels_like)}Â°C</div>
        <div class="small">ğŸ’¨ Vento: ${d.wind.speed} m/s</div>
        <div class="small">ğŸ’§ UmiditÃ : ${d.main.humidity}%</div>
        <div class="small">ğŸŒ… Alba: ${alba} ğŸŒ‡ Tramonto: ${tramonto}</div>
        <a class="map-link" href="https://www.google.com/maps/search/?api=1&query=${d.coord.lat},${d.coord.lon}" target="_blank">ğŸ“ Mostra su mappa</a>
        <div class="small">ğŸ•’ Aggiornato alle ${ora}</div>
    `;

    const app=document.getElementById("app");
    app.querySelectorAll(".pioggia").forEach(p=>p.remove());
    if(d.weather[0].icon.startsWith("09")||d.weather[0].icon.startsWith("10")){
        for(let i=0;i<50;i++){
            const p=document.createElement("div");
            p.className="pioggia";
            p.style.left=Math.random()*450+"px";
            p.style.animationDuration=(0.5+Math.random())+"s";
            app.appendChild(p);
        }
    }
}

function mostraPrevisioni(d){
    const giorni={};
    d.list.forEach(i=>{ const day=i.dt_txt.split(" ")[0]; if(!giorni[day]) giorni[day]=[]; giorni[day].push(i); });
    const keys=Object.keys(giorni).slice(0,5);
    const forecastDiv=document.getElementById("previsioni"); forecastDiv.innerHTML="";
    const labels=[],tempsMin=[],tempsMax=[];
    keys.forEach(day=>{
        const data=giorni[day][0];
        labels.push(day.split("-")[2]+"/"+day.split("-")[1]);
        let min=Math.min(...giorni[day].map(x=>x.main.temp_min));
        let max=Math.max(...giorni[day].map(x=>x.main.temp_max));
        tempsMin.push(min); tempsMax.push(max);
        forecastDiv.innerHTML+=`
        <div class="forecast-day">
            <div>${day.split("-")[2]}/${day.split("-")[1]}</div>
            <div class="icon">${getIcon(data.weather[0].icon)}</div>
            <div>${Math.round(min)}Â°/${Math.round(max)}Â°</div>
        </div>`;
    });
    disegnaGrafico(labels,tempsMin,tempsMax);
}

function getIcon(icon){
    const map={"01d":"â˜€ï¸","01n":"ğŸŒ™","02d":"ğŸŒ¤ï¸","02n":"ğŸŒ¤ï¸","03d":"â˜ï¸","03n":"â˜ï¸","04d":"â˜ï¸","04n":"â˜ï¸","09d":"ğŸŒ§ï¸","09n":"ğŸŒ§ï¸","10d":"ğŸŒ¦ï¸","10n":"ğŸŒ¦ï¸","11d":"â›ˆï¸","11n":"â›ˆï¸","13d":"â„ï¸","13n":"â„ï¸","50d":"ğŸŒ«ï¸","50n":"ğŸŒ«ï¸"};
    return map[icon]||"â˜€ï¸";
}

function disegnaGrafico(labels,min,max){
    const c=document.getElementById("grafico");
    const ctx=c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);
    ctx.strokeStyle="white"; ctx.lineWidth=2; ctx.fillStyle="rgba(255,255,255,0.3)"; ctx.font="12px sans-serif";

    const w=c.width/labels.length;
    const tempMax=Math.max(...max)+2; const tempMin=Math.min(...min)-2;

    ctx.beginPath();
    for(let i=0;i<labels.length;i++){
        const x=w*i+w/2;
        const yMax=c.height-( (max[i]-tempMin)/(tempMax-tempMin)*c.height );
        const yMin=c.height-( (min[i]-tempMin)/(tempMax-tempMin)*c.height );
        if(i===0){ ctx.moveTo(x,yMax); } else { ctx.lineTo(x,yMax); }
    }
    ctx.stroke();

    for(let i=0;i<labels.length;i++){
        const x=w*i+w/2;
        const yMax=c.height-( (max[i]-tempMin)/(tempMax-tempMin)*c.height );
        const yMin=c.height-( (min[i]-tempMin)/(tempMax-tempMin)*c.height );
        ctx.beginPath(); ctx.arc(x,yMax,5,0,2*Math.PI); ctx.fill();
        ctx.beginPath(); ctx.arc(x,yMin,5,0,2*Math.PI); ctx.fill();
        ctx.fillText(labels[i],x-15,c.height-5);
    }
}
</script>
</body>
</html>
