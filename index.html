<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Meteo Avanzato</title>
<style>
* { box-sizing: border-box; }
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg,#1d2671,#c33764);
    color: white;
}
.app {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(15px);
    border-radius: 25px;
    padding: 30px;
    width: 380px;
    max-width: 95%;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    text-align: center;
}
h1 { margin-top:0; }
input, button {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    margin-top:10px;
}
button { font-weight: bold; cursor:pointer; background:#ffffff;color:#333; }
button:hover { opacity:0.9; }
.card { margin-top:20px; }
.temp { font-size:48px; font-weight:bold; }
.small { font-size:14px; opacity:0.9; margin-top:5px; }
.hr { border:none; height:1px; background:rgba(255,255,255,0.3); margin:15px 0; }
.forecast { display:flex; justify-content:space-between; margin-top:15px; }
.forecast-day { flex:1; margin:0 2px; background:rgba(255,255,255,0.1); border-radius:10px; padding:5px; }
.icon { font-size:24px; }
.night { background: linear-gradient(135deg,#0f2027,#203a43); }
</style>
</head>
<body>
<div class="app" id="app">
    <h1>ğŸŒ¦ï¸ Meteo Avanzato</h1>
    <input id="citta" placeholder="Inserisci una cittÃ ">
    <button onclick="cercaCitta()">Cerca</button>
    <button onclick="usaPosizione()">ğŸ“ Usa la mia posizione</button>
    <div id="meteo" class="card"></div>
    <div id="previsioni" class="forecast"></div>
</div>

<script>
const API_KEY = "28a319d5da8a97fe0488bd10b1aaa1e6";

function cercaCitta() {
    const citta = document.getElementById("citta").value.trim();
    if(!citta) return;
    fetchMeteo(`q=${citta}`);
}

function usaPosizione() {
    if(!navigator.geolocation){ alert("Geolocalizzazione non supportata"); return; }
    navigator.geolocation.getCurrentPosition(pos=>{
        fetchMeteo(`lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);
    });
}

function fetchMeteo(param){
    fetch(`https://api.openweathermap.org/data/2.5/weather?${param}&units=metric&lang=it&appid=${API_KEY}`)
    .then(res=>{if(!res.ok)throw new Error(); return res.json()})
    .then(d=>mostraMeteo(d))
    .catch(()=>{document.getElementById("meteo").innerHTML="âŒ Dati non disponibili"; document.getElementById("previsioni").innerHTML=""});
    
    // Fetch 5 giorni
    fetch(`https://api.openweathermap.org/data/2.5/forecast?${param}&units=metric&lang=it&appid=${API_KEY}`)
    .then(res=>res.json())
    .then(d=>mostraPrevisioni(d));
}

function mostraMeteo(d){
    const alba = new Date(d.sys.sunrise*1000).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});
    const tramonto = new Date(d.sys.sunset*1000).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});
    const ora = new Date().toLocaleTimeString("it-IT");
    const nightClass = (new Date().getHours() >= 18 || new Date().getHours() <6)? "night":"";
    document.getElementById("app").className = "app "+nightClass;
    document.getElementById("meteo").innerHTML = `
        <h2>${d.name}</h2>
        <div class="temp">${Math.round(d.main.temp)}Â°C</div>
        <div>${d.weather[0].description} <span class="icon">${getIcon(d.weather[0].icon)}</span></div>
        <div class="small">ğŸŒ¡ï¸ Percepita: ${Math.round(d.main.feels_like)}Â°C</div>
        <div class="small">ğŸ’¨ Vento: ${d.wind.speed} m/s</div>
        <div class="small">ğŸŒ… Alba: ${alba} ğŸŒ‡ Tramonto: ${tramonto}</div>
        <div class="small">ğŸ•’ Aggiornato alle ${ora}</div>
    `;
}

function mostraPrevisioni(d){
    const giorni = {};
    d.list.forEach(item=>{
        const day = item.dt_txt.split(" ")[0];
        if(!giorni[day]) giorni[day]=[];
        giorni[day].push(item);
    });
    const keys = Object.keys(giorni).slice(0,5); // 5 giorni
    const forecastDiv = document.getElementById("previsioni");
    forecastDiv.innerHTML="";
    keys.forEach(day=>{
        const data = giorni[day][0];
        forecastDiv.innerHTML+=`
        <div class="forecast-day">
            <div>${day.split("-")[2]}/${day.split("-")[1]}</div>
            <div class="icon">${getIcon(data.weather[0].icon)}</div>
            <div>${Math.round(data.main.temp_min)}Â°/${Math.round(data.main.temp_max)}Â°</div>
        </div>`;
    });
}

function getIcon(icon){
    // Icone Unicode base
    const map = {
        "01d":"â˜€ï¸","01n":"ğŸŒ™",
        "02d":"ğŸŒ¤ï¸","02n":"ğŸŒ¤ï¸",
        "03d":"â˜ï¸","03n":"â˜ï¸",
        "04d":"â˜ï¸","04n":"â˜ï¸",
        "09d":"ğŸŒ§ï¸","09n":"ğŸŒ§ï¸",
        "10d":"ğŸŒ¦ï¸","10n":"ğŸŒ¦ï¸",
        "11d":"â›ˆï¸","11n":"â›ˆï¸",
        "13d":"â„ï¸","13n":"â„ï¸",
        "50d":"ğŸŒ«ï¸","50n":"ğŸŒ«ï¸"
    };
    return map[icon]||"â˜€ï¸";
}
</script>
</body>
</html>
