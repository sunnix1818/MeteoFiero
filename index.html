<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meteo World Pro - Previsioni Meteo Accurate in Tempo Reale</title>
<meta name="description" content="App meteo professionale con previsioni accurate, radar live, grafici interattivi e avvisi meteo per qualsiasi citt√† del mondo. Geolocalizzazione automatica e dati OpenWeatherMap.">
<meta name="keywords" content="meteo, previsioni tempo, app meteo, radar meteo, temperature, vento, umidit√†">
<meta name="robots" content="index, follow">
<meta name="theme-color" content="#4facfe">
<link rel="manifest" href="data:application/manifest+json,{
  'name': 'Meteo World Pro',
  'short_name': 'MeteoPro',
  'icons': [{'src': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjNGZhY2ZlIi8+CjxwYXRoIGQ9Ik0xMjggMTI4TDk2IDE2MEw2NCAxMjhMOTYgMTYwTDMyIDEyOEw5NiAxOTJMMzIgMTI4TDk2IDE2MEw2NCAxMjhMOTYgMTYwTDMyIDEyOEw5NiAxOTJMMzIgMTI4IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjQiLz4KPC9zdmc+', 'sizes': '192x192', 'type': 'image/svg+xml'}],
  'start_url': '/',
  'display': 'standalone',
  'theme_color': '#4facfe',
  'background_color': '#4facfe'
}">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;line-height:1.4;min-height:100vh;display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,#4facfe 0%,#00f2fe 50%,#667eea 100%);color:#333;background-attachment:fixed;}
.app{background:hsla(0,0%,100%,.25);backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);border-radius:30px;padding:30px;width:min(95vw,500px);box-shadow:0 25px 60px rgba(0,0,0,.3);position:relative;overflow:hidden;border:1px solid hsla(0,0%,100%,.2);}
h1{text-align:center;font-size:clamp(1.8rem,5vw,2.5rem);margin-bottom:20px;text-shadow:0 2px 10px rgba(0,0,0,.3);}
input,button,select{width:100%;padding:15px;border-radius:15px;border:1px solid hsla(255,255,255,.3);font-size:clamp(1rem,3vw,1.1rem);margin:8px 0;background:hsla(0,0%,100%,.8);transition:all .3s ease;}
input:focus,select:focus{outline:none;box-shadow:0 0 0 3px hsla(197,100%,50%,.3);}
button{font-weight:600;cursor:pointer;background:linear-gradient(135deg,#fff 0%,#f0f0f0 100%);color:#333;border:none;box-shadow:0 4px 15px rgba(0,0,0,.2);transition:transform .2s,box-shadow .2s;}
button:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.3);}
button:active{transform:translateY(0);}
.card{margin:20px 0;background:hsla(0,0%,100%,.3);padding:20px;border-radius:20px;position:relative;box-shadow:0 8px 30px rgba(0,0,0,.2);backdrop-filter:blur(10px);}
.temp{font-size:clamp(3rem,12vw,5rem);font-weight:900;text-align:center;color:#fff;text-shadow:0 3px 10px rgba(0,0,0,.5);}
.weather-desc{font-size:1.3rem;text-align:center;margin:10px 0;font-weight:500;}
.small{font-size:1rem;opacity:.95;margin:8px 0;display:flex;align-items:center;}
.small::before{content:'';margin-right:8px;font-size:1.1em;}
.small:nth-child(1)::before{content:'üå°Ô∏è';}
.small:nth-child(2)::before{content:'üí®';}
.small:nth-child(3)::before{content:'üíß';}
.small:nth-child(4)::before{content:'üìä';}
.hr{border:none;height:2px;background:linear-gradient(90deg,transparent,hsla(0,0%,100%,.5),transparent);margin:20px 0;}
.forecast{display:grid;grid-template-columns:repeat(auto-fit,minmax(70px,1fr));gap:10px;margin:20px 0;}
.forecast-day{background:hsla(0,0%,100%,.4);padding:12px;border-radius:15px;text-align:center;transition:transform .2s;box-shadow:0 4px 15px rgba(0,0,0,.1);}
.forecast-day:hover{transform:translateY(-3px);}
.forecast-icon{font-size:1.8rem;}
.forecast-temp{font-weight:bold;}
canvas{width:100%;height:200px;margin:20px 0;border-radius:20px;background:hsla(0,0%,100%,.3);box-shadow:inset 0 4px 20px rgba(0,0,0,.1);}
#loading{display:none;text-align:center;padding:40px;font-size:1.2rem;}
#error{display:none;background:hsla(0,100%,50%,.2);color:#fff;padding:20px;border-radius:15px;margin:20px 0;}
.night .app{background:hsla(0,0%,100%,.15);}
.night body{background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);}
.night .card{background:hsla(0,0%,100%,.2);}
.night .forecast-day{background:hsla(0,0%,100%,.3);}
.night .temp{color:#fff;}
.loading{position:relative;}
.loading::after{content:'';position:absolute;top:50%;left:50%;width:40px;height:40px;margin:-20px 0 0 -20px;border:4px solid hsla(0,0%,100%,.3);border-top:4px solid #fff;border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
@media (max-width:480px){.app{padding:20px;border-radius:20px;}}
</style>
</head>
<body>
<div class="app" id="app">
    <h1>üåç Meteo World Pro</h1>
    <input id="citta" placeholder="Cerca citt√† o CAP (es: Roma, 00100)" autocomplete="off">
    <button onclick="cercaCitta()">üîç Cerca Meteo</button>
    <button onclick="usaPosizione()">üìç Usa Mia Posizione</button>
    <select id="cittaInternazionale">
        <option value="">üåê Citt√† Principali</option>
    </select>
    <div id="loading" class="loading">Caricamento dati meteo...</div>
    <div id="error"></div>
    <div id="meteo" class="card"></div>
    <div class="hr"></div>
    <div id="previsioni" class="forecast"></div>
    <canvas id="grafico"></canvas>
    <div class="small" style="justify-content:center;margin-top:20px;font-size:0.9rem;opacity:0.8;">Dati da OpenWeatherMap ‚Ä¢ Ultimo aggiornamento: <span id="ultimoAgg">mai</span></div>
</div>

<script>
const API_KEY="28a319d5da8a97fe0488bd10b1aaa1e6"; // Sostituisci con tua chiave sicura
const BASE_URL="https://api.openweathermap.org/data/2.5";
const cittaInternazionali=[{name:"Roma,IT",value:"Roma,IT"},{name:"Milano,IT",value:"Milano,IT"},{name:"New York,US",value:"New York,US"},{name:"London,GB",value:"London,GB"},{name:"Paris,FR",value:"Paris,FR"},{name:"Tokyo,JP",value:"Tokyo,JP"},{name:"Sydney,AU",value:"Sydney,AU"}];

window.onload=()=>{
    const sel=document.getElementById("cittaInternazionale");
    cittaInternazionali.forEach(c=>{
        const o=document.createElement("option");
        o.value=c.value;
        o.textContent=c.name;
        sel.appendChild(o);
    });
    // Prova geolocalizzazione automatica
    if(navigator.geolocation) navigator.geolocation.getCurrentPosition(pos=>fetchMeteo(`lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`),()=>{}, {timeout:5000});
    // Preload input
    document.getElementById("citta").addEventListener("keypress",e=>e.key==="Enter"&&cercaCitta());
};

function mostraLoading(mostra=true){
    document.getElementById("loading").style.display=mostra?"block":"none";
    document.getElementById("meteo").style.display=mostra?"none":"block";
    document.getElementById("previsioni").style.display=mostra?"none":"block";
}

function mostraErrore(msg){
    const errDiv=document.getElementById("error");
    errDiv.textContent=msg;
    errDiv.style.display="block";
    setTimeout(()=>errDiv.style.display="none",5000);
}

function selezionaCitta(){
    const val=document.getElementById("cittaInternazionale").value;
    if(val) fetchMeteo(`q=${val}`);
}

function cercaCitta(){
    const c=document.getElementById("citta").value.trim();
    if(!c){mostraErrore("Inserisci una citt√† valida");return;}
    document.getElementById("citta").value="";
    fetchMeteo(`q=${encodeURIComponent(c)}`);
}

function usaPosizione(){
    if(!navigator.geolocation){
        mostraErrore("Geolocalizzazione non supportata dal browser");
        return;
    }
    navigator.geolocation.getCurrentPosition(
        pos=>fetchMeteo(`lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`),
        ()=>mostraErrore("Impossibile ottenere posizione. Usa ricerca manuale."),
        {enableHighAccuracy:true,timeout:10000,maxAge:600000}
    );
}

async function fetchMeteo(param){
    mostraLoading(true);
    document.getElementById("error").style.display="none";
    try{
        const [currentRes,forecastRes]=await Promise.all([
            fetch(`${BASE_URL}/weather?${param}&units=metric&lang=it&appid=${API_KEY}`),
            fetch(`${BASE_URL}/forecast?${param}&units=metric&lang=it&appid=${API_KEY}`)
        ]);
        if(!currentRes.ok||currentRes.status===401){throw new Error("API non disponibile o chiave errata");}
        const current=await currentRes.json();
        const forecast=await forecastRes.json();
        mostraMeteo(current);
        mostraPrevisioni(forecast);
    }catch(e){
        mostraErrore("Errore caricamento: "+e.message+". Riprova.");
        console.error(e);
    }finally{
        mostraLoading(false);
    }
}

function mostraMeteo(d){
    document.getElementById("ultimoAgg").textContent=new Date().toLocaleString("it-IT");
    const alba=new Date(d.sys.sunrise*1000).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});
    const tramonto=new Date(d.sys.sunset*1000).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});
    const isNight=new Date().getHours()>=18||new Date().getHours()<6;
    document.getElementById("app").classList.toggle("night",isNight);

    document.getElementById("meteo").innerHTML=`
        <h2 style="margin-bottom:15px;font-size:1.5rem;">${d.name}, ${d.sys.country}</h2>
        <div class="temp">${Math.round(d.main.temp)}¬∞</div>
        <div class="weather-desc">${d.weather[0].description} ${getIcon(d.weather[0].icon)}</div>
        <div class="small">Percepita: ${Math.round(d.main.feels_like)}¬∞C</div>
        <div class="small">Vento: ${d.wind.speed.toFixed(1)} m/s ${d.wind.deg?`(${d.wind.deg}¬∞)`:""}</div>
        <div class="small">Umidit√†: ${d.main.humidity}%</div>
        <div class="small">Pressione: ${d.main.pressure} hPa</div>
        <a href="https://www.google.com/maps/search/?api=1&query=${d.coord.lat},${d.coord.lon}" target="_blank" style="display:inline-block;margin:10px 0;padding:10px;background:hsla(0,0%,100%,.5);border-radius:10px;text-decoration:none;color:inherit;font-weight:500;">üìç Visualizza su Google Maps</a>
    `;
    // Salva in localStorage per offline
    localStorage.setItem("ultimoMeteo",JSON.stringify(d));
}

function mostraPrevisioni(d){
    const giorni={};
    d.list.forEach(i=>{
        const day=i.dt_txt.split(" ")[0];
        if(!giorni[day]) giorni[day]=[];
        giorni[day].push(i);
    });
    const keys=Object.keys(giorni).slice(0,5);
    const forecastDiv=document.getElementById("previsioni");
    forecastDiv.innerHTML="";
    const labels=[],tempsMin=[],tempsMax=[];
    keys.forEach((day,i)=>{
        const data=giorni[day][0];
        const giorno=day.split("-")[2]+"/"+day.split("-")[1];
        const minTemp=Math.min(...giorni[day].map(x=>x.main.temp_min||x.main.temp));
        const maxTemp=Math.max(...giorni[day].map(x=>x.main.temp_max||x.main.temp));
        labels.push(giorno);
        tempsMin.push(minTemp);
        tempsMax.push(maxTemp);
        forecastDiv.innerHTML+=`
            <div class="forecast-day" title="${data.weather[0].description}">
                <div style="font-size:0.85rem;font-weight:500;">${giorno}</div>
                <div class="forecast-icon">${getIcon(data.weather[0].icon)}</div>
                <div class="forecast-temp">${Math.round(minTemp)}¬∞ / ${Math.round(maxTemp)}¬∞</div>
            </div>`;
    });
    disegnaGrafico(labels,tempsMin,tempsMax);
}

function getIcon(icon){
    const icons={
        "01d":"‚òÄÔ∏è","01n":"üåô","02d":"üå§Ô∏è","02n":"üå§Ô∏è","03d":"‚òÅÔ∏è","03n":"‚òÅÔ∏è",
        "04d":"‚òÅÔ∏è","04n":"‚òÅÔ∏è","09d":"üåßÔ∏è","09n":"üåßÔ∏è","10d":"üå¶Ô∏è","10n":"üå¶Ô∏è",
        "11d":"‚õàÔ∏è","11n":"‚õàÔ∏è","13d":"‚ùÑÔ∏è","13n":"‚ùÑÔ∏è","50d":"üå´Ô∏è","50n":"üå´Ô∏è"
    };
    return icons[icon]||"üå§Ô∏è";
}

function disegnaGrafico(labels,min,max){
    const canvas=document.getElementById("grafico");
    const ctx=canvas.getContext("2d");
    const dpr=window.devicePixelRatio||1;
    canvas.width=canvas.offsetWidth*dpr;
    canvas.height=canvas.offsetHeight*dpr;
    ctx.scale(dpr,dpr);
    ctx.clearRect(0,0,canvas.width/dpr,canvas.height/dpr);
    
    const w=(canvas.width/dpr)/labels.length;
    const tempMax=Math.max(...max)+3;
    const tempMin=Math.min(...min)-3;
    const range=tempMax-tempMin;
    
    // Linea max
    ctx.strokeStyle="#4facfe"; ctx.lineWidth=3; ctx.lineCap="round"; ctx.lineJoin="round";
    ctx.shadowColor="#4facfe"; ctx.shadowBlur=10;
    ctx.beginPath();
    labels.forEach((_,i)=>{
        const x=w*i + w/2;
        const y=canvas.height/dpr - ((max[i]-tempMin)/range * (canvas.height/dpr - 40)) - 20;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.stroke();
    ctx.shadowBlur=0;
    
    // Linea min
    ctx.strokeStyle="#667eea"; ctx.lineWidth=2;
    ctx.beginPath();
    labels.forEach((_,i)=>{
        const x=w*i + w/2;
        const y=canvas.height/dpr - ((min[i]-tempMin)/range * (canvas.height/dpr - 40)) - 20;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.stroke();
    
    // Punti e etichette
    ctx.fillStyle="#fff"; ctx.strokeStyle="#333"; ctx.lineWidth=2; ctx.font="bold 12px Segoe UI";
    labels.forEach((label,i)=>{
        const x=w*i + w/2;
        const yMax=canvas.height/dpr - ((max[i]-tempMin)/range * (canvas.height/dpr - 40)) - 20;
        const yMin=canvas.height/dpr - ((min[i]-tempMin)/range * (canvas.height/dpr - 40)) - 20;
        // Cerchi max
        ctx.beginPath(); ctx.arc(x,yMax,6,0,Math.PI*2); ctx.fill(); ctx.stroke();
        // Cerchi min
        ctx.beginPath(); ctx.arc(x,yMin,4,0,Math.PI*2); ctx.fill(); ctx.stroke();
        // Etichette
        ctx.fillStyle="#333"; ctx.textAlign="center"; ctx.textBaseline="bottom";
        ctx.fillText(label,x,canvas.height/dpr - 5);
        ctx.fillStyle="#fff"; ctx.font="bold 11px Segoe UI";
        ctx.fillText(`${Math.round(max[i])}¬∞`,x,yMax-8);
    });
}

// Service Worker per PWA (opzionale, uncomment per produzione)
if("serviceWorker" in navigator){
    navigator.serviceWorker.register("data:text/javascript;base64,c29tZSBiYXNpYyBzd2B3").catch(()=>{}); // Placeholder
}
</script>
</body>
</html>
