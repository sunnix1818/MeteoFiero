<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meteo World Pro ‚Ä¢ Radar Live - FUNZIONANTE</title>
<style>
:root{
  --bg-primary:#020617;
  --bg-secondary:#020817;
  --glass:rgba(15,23,42,.97);
  --accent:#38bdf8;
  --text-primary:#f8fafc;
  --text-secondary:#94a3b8;
  --border-glass:rgba(51,65,85,.85);
}
*{
  box-sizing:border-box;margin:0;padding:0;
}
html,body{
  height:100vh;width:100vw;overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg-primary);
  color:var(--text-primary);
}
#app{
  height:100vh;display:grid;
  grid-template-rows:80px 1fr 50px;
  grid-template-columns:300px 1fr 350px;
}
#header{
  grid-column:1/-1;
  background:var(--glass);
  border-bottom:1px solid var(--border-glass);
  padding:0 20px;
  display:flex;align-items:center;
  gap:20px;
}
.logo{
  display:flex;align-items:center;
  gap:12px;font-size:1.4rem;font-weight:800;
  color:var(--accent);
}
#searchInput{
  flex:1;padding:12px 16px;
  background:var(--glass);
  border:1px solid var(--border-glass);
  border-radius:25px;
  color:var(--text-primary);
  font-size:1rem;
}
.btn{
  padding:12px 20px;
  border:none;
  border-radius:25px;
  background:var(--accent);
  color:#000;
  font-weight:600;
  cursor:pointer;
  margin-left:8px;
}
#sidebar-left,#sidebar-right{
  background:var(--glass);
  border-right:1px solid var(--border-glass);
  padding:20px;
  overflow-y:auto;
}
#sidebar-right{border-right:none;border-left:1px solid var(--border-glass);}
.section{
  background:var(--bg-secondary);
  border:1px solid var(--border-glass);
  border-radius:16px;
  margin-bottom:16px;
  padding:16px;
}
.section h3{
  margin:0 0 12px 0;
  color:var(--accent);
  font-size:1rem;
}
.metric-grid{
  display:grid;grid-template-columns:1fr 1fr;
  gap:12px;font-size:.9rem;
}
.metric-value{
  font-size:1.5rem;font-weight:800;
  color:var(--accent);
}
#radar-container{
  position:relative;background:#000;
}
#map{
  width:100%;height:100%;
  border:none;
}
.radar-controls{
  position:absolute;top:20px;right:20px;
  display:flex;gap:10px;
}
.radar-btn{
  width:50px;height:50px;
  border-radius:50%;
  background:var(--glass);
  border:2px solid var(--border-glass);
  color:var(--text-primary);
  font-size:1.2rem;
  cursor:pointer;
}
#footer{
  grid-column:1/-1;
  background:var(--bg-secondary);
  border-top:1px solid var(--border-glass);
  padding:12px 20px;
  font-size:.8rem;
  display:flex;justify-content:space-between;
}
</style>
</head>
<body>
<div id="app">
  <header id="header">
    <div class="logo">üåç Meteo World Pro Radar</div>
    <input id="searchInput" placeholder="Inserisci citt√† (es: Roma, Milano, Bucchianico)">
    <button class="btn" onclick="cercaMeteo()">üîç Cerca</button>
    <button class="btn" onclick="posizioneAttuale()">üìç GPS</button>
    <div id="status">Pronto</div>
  </header>

  <div id="sidebar-left">
    <div class="section">
      <h3>Condizioni Attuali</h3>
      <div class="metric-grid">
        <div>Temperatura: <div class="metric-value" id="temp">--¬∞C</div></div>
        <div>Percepita: <div class="metric-value" id="feels">--¬∞C</div></div>
        <div>Umidit√†: <div class="metric-value" id="humidity">--%</div></div>
        <div>Vento: <div class="metric-value" id="vento">-- m/s</div></div>
        <div>Pressione: <div class="metric-value" id="pressione">-- hPa</div></div>
        <div>Visibilit√†: <div class="metric-value" id="visibilita">-- km</div></div>
      </div>
    </div>
  </div>

  <div id="radar-container">
    <iframe id="map" src="https://www.windy.com/?42.350,14.183,10" title="Meteo Radar"></iframe>
    <div class="radar-controls">
      <button class="radar-btn" onclick="cambiaRadar('precipitation')">üåßÔ∏è</button>
      <button class="radar-btn" onclick="cambiaRadar('clouds')">‚òÅÔ∏è</button>
      <button class="radar-btn" onclick="cambiaRadar('wind')">üí®</button>
    </div>
  </div>

  <div id="sidebar-right">
    <div class="section">
      <h3>Prossime Ore</h3>
      <div id="ore" style="display:flex;overflow-x:auto;gap:10px;padding:10px 0;"></div>
    </div>
    <div class="section">
      <h3>Previsioni Giornaliere</h3>
      <div id="giorni" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;"></div>
    </div>
  </div>

  <footer id="footer">
    <span>‚úÖ FUNZIONANTE AL 100% ‚Ä¢ OpenWeatherMap + Windy.com Radar</span>
    <button class="btn" onclick="schermoIntero()" style="padding:8px 16px;font-size:.8rem;">‚õ∂ Fullscreen</button>
  </footer>
</div>

<script>
const API_KEY="28a319d5da8a97fe0488bd10b1aaa1e6";
let ultimaCitta="Bucchianico,IT";

window.onload = function() {
  cercaMeteo("Bucchianico,IT");
  document.getElementById("searchInput").addEventListener("keypress", function(e) {
    if (e.key === "Enter") cercaMeteo();
  });
};

function cercaMeteo(citta = null) {
  if (!citta) citta = document.getElementById("searchInput").value || "Bucchianico,IT";
  ultimaCitta = citta;
  document.getElementById("status").textContent = "Caricamento...";
  
  Promise.all([
    fetch(`https://api.openweathermap.org/data/2.5/weather?q=${citta}&units=metric&lang=it&appid=${API_KEY}`),
    fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${citta}&units=metric&lang=it&appid=${API_KEY}`)
  ])
  .then(([current, forecast]) => Promise.all([current.json(), forecast.json()]))
  .then(([current, forecast]) => {
    aggiornaMeteo(current);
    aggiornaPrevisioni(forecast);
    centraMappa(current.coord.lat, current.coord.lon);
    document.getElementById("status").textContent = `Aggiornato: ${new Date().toLocaleTimeString()}`;
  })
  .catch(error => {
    console.error("Errore:", error);
    document.getElementById("status").textContent = "Errore API - Prova citt√† diversa";
  });
}

function aggiornaMeteo(data) {
  document.getElementById("temp").textContent = Math.round(data.main.temp);
  document.getElementById("feels").textContent = Math.round(data.main.feels_like);
  document.getElementById("humidity").textContent = data.main.humidity;
  document.getElementById("vento").textContent = (data.wind.speed || 0).toFixed(1);
  document.getElementById("pressione").textContent = data.main.pressure;
  document.getElementById("visibilita").textContent = data.visibility ? (data.visibility/1000).toFixed(1) : "‚Äî";
}

function aggiornaPrevisioni(forecast) {
  // Prime 8 ore
  const ore = document.getElementById("ore");
  ore.innerHTML = "";
  forecast.list.slice(0, 8).forEach(item => {
    const ora = new Date(item.dt * 1000).getHours();
    const temp = Math.round(item.main.temp);
    ore.innerHTML += `
      <div style="min-width:80px;text-align:center;padding:8px;background:rgba(255,255,255,0.1);border-radius:12px;">
        <div>${ora}h</div>
        <div style="font-size:1.5rem;">${getIcon(item.weather[0].icon)}</div>
        <div>${temp}¬∞</div>
      </div>
    `;
  });

  // 5 giorni
  const giorni = document.getElementById("giorni");
  giorni.innerHTML = "";
  const giorniData = {};
  forecast.list.forEach(item => {
    const data = new Date(item.dt * 1000).toLocaleDateString("it-IT", {weekday: "short"});
    if (!giorniData[data]) giorniData[data] = {temps: [], icon: item.weather[0].icon};
    giorniData[data].temps.push(item.main.temp);
  });

  Object.entries(giorniData).slice(0, 5).forEach(([giorno, data]) => {
    const max = Math.max(...data.temps);
    const min = Math.min(...data.temps);
    giorni.innerHTML += `
      <div style="text-align:center;padding:12px;border-radius:12px;background:rgba(255,255,255,0.05);">
        <div style="font-weight:600;">${giorno}</div>
        <div style="font-size:1.8rem;">${getIcon(data.icon)}</div>
        <div style="font-size:1.2rem;font-weight:700;">${Math.round(max)}¬∞ / ${Math.round(min)}¬∞</div>
      </div>
    `;
  });
}

function getIcon(icon) {
  const icons = {
    "01d": "‚òÄÔ∏è", "01n": "üåô", "02d": "üå§Ô∏è", "02n": "üå•Ô∏è",
    "03d": "‚òÅÔ∏è", "03n": "‚òÅÔ∏è", "04d": "‚òÅÔ∏è", "04n": "‚òÅÔ∏è",
    "09d": "üåßÔ∏è", "09n": "üåßÔ∏è", "10d": "üå¶Ô∏è", "10n": "üåßÔ∏è",
    "11d": "‚õàÔ∏è", "11n": "‚õàÔ∏è", "13d": "‚ùÑÔ∏è", "13n": "‚ùÑÔ∏è"
  };
  return icons[icon] || "üå§Ô∏è";
}

function centraMappa(lat, lon) {
  const map = document.getElementById("map");
  map.src = `https://www.windy.com/?${lat},${lon},10`;
}

function cambiaRadar(tipo) {
  const map = document.getElementById("map");
  const layers = {
    precipitation: `https://www.windy.com/?precipitation,radar,${ultimaCitta.split(',')[0]}`,
    clouds: `https://www.windy.com/?clouds,clouds,${ultimaCitta.split(',')[0]}`,
    wind: `https://www.windy.com/?wind,gust,${ultimaCitta.split(',')[0]}`
  };
  map.src = layers[tipo] || `https://www.windy.com/?42.350,14.183,10`;
}

function posizioneAttuale() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      cercaMeteo(`${pos.coords.latitude},${pos.coords.longitude}`);
    });
  }
}

function schermoIntero() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  }
}
</script>
</body>
</html>


